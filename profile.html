<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROFILE</title>
    <link rel="stylesheet" href="profile.css">

</head>

<body>
    <div class="nav">

        <a href="#"><button id="first"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"/></svg>PROFILE</button></a>
        <a href="upload.html"><button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0H224V128c0 17.7 14.3 32 32 32H384V448c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0L384 128z"/></svg>UPLOAD DOCUMENT</button></a>
        <a href=""><button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M64 64C28.7 64 0 92.7 0 128V384c0 35.3 28.7 64 64 64H512c35.3 0 64-28.7 64-64V128c0-35.3-28.7-64-64-64H64zm64 320H64V320c35.3 0 64 28.7 64 64zM64 192V128h64c0 35.3-28.7 64-64 64zM448 384c0-35.3 28.7-64 64-64v64H448zm64-192c-35.3 0-64-28.7-64-64h64v64zM288 160a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"/></svg>BILL</button></a>
        <a href="booking.html"><button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192h80v56H48V192zm0 104h80v64H48V296zm128 0h96v64H176V296zm144 0h80v64H320V296zm80-48H320V192h80v56zm0 160v40c0 8.8-7.2 16-16 16H320V408h80zm-128 0v56H176V408h96zm-144 0v56H64c-8.8 0-16-7.2-16-16V408h80zM272 248H176V192h96v56z"/></svg>BOOKING</button></a>
        <a href=""><button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"/></svg>LOG OUT</button></a>

    </div>
    <form>
        <div class="name"><label>First Name/पहिले नाव :</label><input id="firstname" type="text"></div><br>
        <div class="name"><label>Middle Name/मधले नाव:</label><input id="middlename" type="text"></div><br>
        <div class="name"><label>Last Name/आडनाव:</label><input id="lastname" type="text"></div>
        <br>
        <div class="name"><label>Age/वय :</label><input id="age" type="text"></div><br>
        <div class="name"><label>gender/ लिंग:</label>
            <select id="gender">
                <option value="Male">Male/पुरुष</option>
                <option value="Female">Female/स्त्री
                </option>
                <option value="Other">Other/इतर</option>
            </select>
        </div><br>
        <div class="name"><label>Date of Birth/जन्मतारीख:</label><input id="DOB" type="date"></div> <br>
        <hr>
        <div class="name"><label>State/राज्य:</label><input id="state" type="text"></div><br>
        <div class="name"><label>District/जिल्हा:</label><input id="district" type="text"></div><br>
        <div class="name"><label>Vilage/Toun/City/गाव/नगर/शहर :</label><input id="village" type="text"></div><br>
        <div class="name"><label>Full HOME Address/संपूर्ण घराचा पत्ता:</label><br><textarea id="address"></textarea>
        </div><br>
        <div class="name"><label>Pin Code/पिन कोड :</label><input id="pinCode" type="text"></div><br>
        <hr>
        <div class="name">
            <label>Email_Id/ई-मेल आयडी :</label><input id="email" type="email" disabled>
        </div><br>
        <div class="name"><label>mobile No/मोबाईल क्रमांक :</label><input id="mobileNo" type="text"></div><br><br>
        <hr>
        <button type="button" onclick="editMyProfile()">Save and Next/जतन करा आणि पुढे जा</button>
    </form>
  

    <script>
        function fetchMyProfile() {
            var username = localStorage.getItem("username");

            fetch('http://127.0.0.1:5000/my-profile?username=' + encodeURIComponent(username), {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    if (data.data) {
                        populateFormFields(data?.data[0])
                    } else if (data.message) {
                        alert(data.message);
                    }
                })
                .catch(error => {
                    console.error('There was an error!', error);
                    alert("An error occurred. Please try again."); // Show error message if there's an error in the API call
                });
        }

        // Function to populate form fields
        function populateFormFields(data) {
            console.log("data", data)
            document.getElementById("firstname").value = data.firstname;
            document.getElementById("middlename").value = data.middlename;
            document.getElementById("lastname").value = data.lastname;
            document.getElementById("age").value = data.age;
            document.getElementById("gender").value = data.gender;
            let dob = new Date(data.dob);
            let formattedDob = dob.toISOString().split('T')[0]; // Extracting yyyy-MM-dd part
            document.getElementById("DOB").value = formattedDob;
            document.getElementById("state").value = data.state;
            document.getElementById("district").value = data.district;
            document.getElementById("village").value = data.village;
            document.getElementById("address").value = data.address;
            document.getElementById("pinCode").value = data.pincode;
            document.getElementById("email").value = data.username;
            document.getElementById("mobileNo").value = data.mobileno;
        }

        // Call fetchMyProfile() function once the page loads
        window.onload = fetchMyProfile;

        // To edit and save the data
        function editMyProfile() {
            var firstname = document.getElementById("firstname").value;
            var middleName = document.getElementById("middlename").value;
            var lastname = document.getElementById("lastname").value;
            var age = document.getElementById("age").value;
            var gender = document.getElementById("gender").value;
            var DOB = document.getElementById("DOB").value;
            var mobileNo = document.getElementById("mobileNo").value;
            var state = document.getElementById("state").value;
            var district = document.getElementById("district").value;
            var village = document.getElementById("village").value;
            var pinCode = document.getElementById("pinCode").value;
            var address = document.getElementById("address").value;
            var userName = document.getElementById("email").value;

            // Request body data
            var data = {
                username: userName,
                firstname: firstname,
                middleName: middleName,
                lastname: lastname,
                age: age,
                gender: gender,
                DOB: DOB,
                mobileNo: mobileNo,
                state: state,
                district: district,
                village: village,
                pinCode: pinCode,
                address: address
            };

            fetch('http://127.0.0.1:5000/edit-my-profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)

            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Network response was not ok.');
                })
                .then(data => {
                    if (data.data) {
                        alert(data.data)
                    } else if (data.message) {
                        alert(data.message);
                    }
                })
                .catch(error => {
                    console.error('There was an error!', error);
                    // Show error message if there's an error in the API call
                });
        }

    </script>
</body>

</html>